<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Rubik's Cube</title>
		<style>
			body { 
				margin: 2px;
				background-color: #f0f0f0;
				text-align: center;
				font-size: x-small;
			}
			#info {
				color: #ffffff;
				position: absolute;
				top: 0px; width: 100%;
				padding: 5px;
			}
		</style>
	</head>
	<body>
		<br/>
		<div class="info" style="font-size:small">
			Welcome to Rubik's Cube !
		</div>
		<br/>
		<div id="cube"></div>
		</br>
		<div class="info">
			Scramble: <a onclick="onCommand('S')" href="#">S</a>
			Fold/Unfold: <a onclick="onCommand('O')" href="#">O</a> <br/>
			Rotate Front Face: <a onclick="onCommand('F')" href="#">F</a>
			Rotate Front Face Counterclockwise: <a onclick="onCommand('F\'')" href="#">F'</a>
			Rotate Back Face: <a onclick="onCommand('B')" href="#">B</a>
			Rotate Back Face Counterlockwise: <a onclick="onCommand('B\'')" href="#">B'</a> <br/>
			Rotate Left Face: <a onclick="onCommand('L')" href="#">L</a>
			Rotate Left Face Counterclockwise: <a onclick="onCommand('L\'')" href="#">L'</a>
			Rotate Right Face: <a onclick="onCommand('R')" href="#">R</a>
			Rotate Right Face Counterclockwise: <a onclick="onCommand('R\'')" href="#">R'</a> <br/>
			Rotate Up Face: <a onclick="onCommand('U')" href="#">U</a>
			Rotate Up Face Counterclockwise: <a onclick="onCommand('U\'')" href="#">U'</a>
			Rotate Down Face: <a onclick="onCommand('D')" href="#">D</a>
			Rotate Down Face Counterclockwise: <a onclick="onCommand('D\'')" href="#">D'</a><br/>
			Set transparency: <input type="range" min="0" max="100" step="1" value="0" onchange="onChangeTransparent(this.value)"><br/>
			Singmaster cubicle notation: <label></label>UF UR UB UL DF DR DB DL FR FL BR BL UFR URB UBL ULF DRF DFL DLB DBR<br/>
			Initial singmaster position: <input type="text" name="init_position" id="init_position" size="67" maxlength="67"> <button type="button" onclick="set_initial_position()"> Set</button> <label id="message" style="color:red"></label><br/>
			Beginner's method solver, layer by layer: <a onclick="on_bottom_up_solver()" href="#">V</a>
		</div>		
		<br/>
		<div><a href="mailto:cube@dingn.com?Subject=about%20rubiks%20cube" target="_top">Comments and Questions ?</a> </div>
		<script src="lib/three.min.js"></script>
		<script src="lib/controls/OrbitControls.js"></script>
		<script src="lib/Tween.js"></script>
		<script src="src/common.js"></script>
		<script src="src/cubestate.js"></script>
		<script src="src/cubeconfig.js"></script>
		<script src="src/transformer.js"></script>
		<script src="src/rubikscube.js"></script>
		<script src="src/cubeinteractive.js"></script>
		<script src="src/cubeconsole.js"></script>
		<script src="src/bottomupsolver.js"></script>
		<script>
var cube_element = document.getElementById("cube");
var cube_console = new CubeConsole(SINGMASTER_SOLVED_STATE, cube_element);
cube_console.render();

document.addEventListener( 'keypress', onDocumentKeyPress, false );
document.addEventListener( 'keydown', onDocumentKeyDown, false );	
cube_console.renderer.domElement.addEventListener('mousedown', onMouseDown, false);
cube_console.renderer.domElement.addEventListener('mousemove', onMouseMove, false);
cube_console.renderer.domElement.addEventListener('mouseup', onMouseUp, false);
cube_console.renderer.domElement.addEventListener('touchstart', onMouseDown, false);
cube_console.renderer.domElement.addEventListener('touchmove', onMouseMove, false);
cube_console.renderer.domElement.addEventListener('touchend', onMouseUp, false);

function onMouseUp(event){
	cube_console.interactive.on_mouse_up(event);
}	

function onMouseMove(event){
	cube_console.interactive.on_mouse_move(event);
}	

function onMouseDown(event){
	cube_console.interactive.on_mouse_down(event);
}	

function onDocumentKeyDown( event ) {
	var keyCode = event.keyCode;
	if ( keyCode == 8 ) {
		//event.preventDefault();
		cube_console.delete_char();
		//console.log("deleting");
		//return false;
	}
}

function onDocumentKeyPress ( event ) {
	var keyCode = event.which;
	if ( keyCode == 8 ) {

		//event.preventDefault();
	} else if (document.activeElement.nodeName == "BODY"){
		var ch = String.fromCharCode( keyCode );
		if(ch.toUpperCase()=="V"){
			on_bottom_up_solver();
		}else
			cube_console.input_char(ch);
	}
}	

function onCommand(op){
	cube_console.cube.command(op);
}

function onChangeTransparent(value){
	transparent = value;
	opacity = (100-transparent)/100;
	cube_console.cube.set_opacity(opacity);
}

function on_bottom_up_solver(){
	cube_console.cube.set_is_in_solver_mode(true);
	var solver = new BottomupSolver(cube_console.cube.get_state());
	solver.solve().forEach(op=>cube_console.cube.command(op));
}

function set_initial_position(){
	var init_state = document.getElementById("init_position").value;
	if (!is_valid_cube_state(init_state)){
		document.getElementById("init_position").select();
		document.getElementById("message").innerText = "invalid state !";
		return;
	}else{
		document.getElementById("message").innerText = "";
		cube_console.cube.set_cube_state(init_state);
	}
}
		</script>
		

	</body>
</html>
